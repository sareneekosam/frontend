<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Questions - TVA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .question-count {
    background: #667eea;
    color: white;
    border-radius: 12px;
    padding: 2px 8px;
    font-size: 0.8rem;
    margin-left: 10px;
}

.request-status {
    font-size: 0.8rem;
    padding: 2px 8px;
    border-radius: 4px;
    margin-left: 10px;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
}

.status-approved {
    background: #d1edf1;
    color: #0c5460;
}

.status-rejected {
    background: #f8d7da;
    color: #721c24;
}
        .questions-container {
            max-width: 1400px;
            margin: 100px auto 30px auto;
            padding: 0 15px;
        }
        .questions-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            margin-bottom: 0;
        }
        .questions-body {
            background: white;
            padding: 40px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .question-tabs .nav-link {
            font-weight: 500;
            padding: 12px 24px;
        }
        .question-tabs .nav-link.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .question-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            background: #f8f9fa;
            position: relative;
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .question-text {
            font-weight: 600;
            font-size: 0.9rem;
            flex: 1;
            margin-right: 15px;
            line-height: 1.3;
        }
        .question-actions {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .question-count {
            background: #667eea;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        .answer-text {
            color: #495057;
            margin-top: 8px;
            padding-left: 10px;
            border-left: 3px solid #667eea;
            font-size: 0.85rem;
            line-height: 1.3;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #dee2e6;
        }
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .dropdown-menu {
            min-width: 150px;
        }
        .requested-question {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
        .modification-requests {
            background: #d1ecf1;
            border-color: #bee5eb;
        }
        .request-status {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 4px;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-approved {
            background: #d1edf1;
            color: #0c5460;
        }
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        /* Add this to the existing styles */
.client-container {
    max-width: 1400px;
    margin: 80px auto 20px auto;
    padding: 0 15px;
}

.client-section {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.client-section h4 {
    font-size: 1.1rem;
    margin-bottom: 10px;
}

.three-dots-btn {
    background: none;
    border: none;
    font-size: 1.1rem;
    padding: 0 5px;
    color: #6c757d;
}

.three-dots-btn:hover {
    color: #495057;
}

.dropdown-menu {
    font-size: 0.85rem;
    min-width: 120px;
}
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-robot me-2"></i>TVA
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="dashboard.html"><i class="fas fa-home me-1"></i> Dashboard</a>
                <a class="nav-link" href="settings.html"><i class="fas fa-cog me-1"></i> Settings</a>
                <a class="nav-link active" href="questions.html"><i class="fas fa-question-circle me-1"></i> Questions</a>
                <a class="nav-link" href="#" onclick="authService.logout()"><i class="fas fa-sign-out-alt me-1"></i> Logout</a>
            </div>
        </div>
    </nav>

    <div class="questions-container">
        <div class="questions-header">
            <h1><i class="fas fa-question-circle me-2"></i>Manage Questions</h1>
            <p class="mb-0">View and manage your questions and requested questions</p>
        </div>
        
        <div class="questions-body">
            <!-- Question Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="card-title text-primary" id="validQuestionsCount">0</h3>
                            <p class="card-text">Valid Questions</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="card-title text-warning" id="requestedQuestionsCount">0</h3>
                            <p class="card-text">Requested Questions</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="card-title text-info" id="pendingRequestsCount">0</h3>
                            <p class="card-text">Pending Requests</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="card-title text-success" id="userHitsCount">0</h3>
                            <p class="card-text">User Hits Used</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question Tabs -->
            <ul class="nav nav-tabs question-tabs" id="questionTabs">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#validQuestions">
                        <i class="fas fa-check-circle me-2"></i>Valid Questions
                        <span class="badge bg-primary ms-1" id="validQuestionsBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#requestedQuestions">
                        <i class="fas fa-question me-2"></i>Requested Questions
                        <span class="badge bg-warning ms-1" id="requestedQuestionsBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#modificationRequests">
                        <i class="fas fa-edit me-2"></i>Modification Requests
                        <span class="badge bg-info ms-1" id="modificationRequestsBadge">0</span>
                    </a>
                </li>
            </ul>
            
            <div class="tab-content mt-4">
                <!-- Valid Questions Tab -->
                <div class="tab-pane fade show active" id="validQuestions">
                    <div id="validQuestionsList">
                        <div class="empty-state">
                            <i class="fas fa-question-circle"></i>
                            <h4>No Valid Questions</h4>
                            <p>Questions that have been answered will appear here.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Requested Questions Tab -->
                <div class="tab-pane fade" id="requestedQuestions">
                    <div id="requestedQuestionsList">
                        <div class="empty-state">
                            <i class="fas fa-question"></i>
                            <h4>No Requested Questions</h4>
                            <p>Questions asked by users that need answers will appear here.</p>
                        </div>
                    </div>
                </div>

                <!-- Modification Requests Tab -->
                <div class="tab-pane fade" id="modificationRequests">
                    <div id="modificationRequestsList">
                        <div class="empty-state">
                            <i class="fas fa-edit"></i>
                            <h4>No Modification Requests</h4>
                            <p>Your question modification requests will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modify Question Modal -->
    <div class="modal fade" id="modifyQuestionModal" tabindex="-1" aria-labelledby="modifyQuestionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modifyQuestionModalLabel">
                        <i class="fas fa-edit me-2"></i>Modify Question
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="modifyQuestionForm">
                        <input type="hidden" id="modifyQuestionId">
                        <input type="hidden" id="modifyQuestionType">
                        <div class="mb-3">
                            <label for="modifyQuestionText" class="form-label">Question</label>
                            <input type="text" class="form-control" id="modifyQuestionText" required>
                        </div>
                        <div class="mb-3">
                            <label for="modifyAnswerText" class="form-label">Answer</label>
                            <textarea class="form-control" id="modifyAnswerText" rows="4" required></textarea>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            This modification request will be sent to admin for approval.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitModificationRequest()">
                        <i class="fas fa-paper-plane me-2"></i>Submit Request
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Answer Modal -->
    <div class="modal fade" id="addAnswerModal" tabindex="-1" aria-labelledby="addAnswerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAnswerModalLabel">
                        <i class="fas fa-plus me-2"></i>Add Answer
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addAnswerForm">
                        <input type="hidden" id="addAnswerQuestionId">
                        <div class="mb-3">
                            <label class="form-label">Question</label>
                            <p class="form-control-plaintext fw-bold" id="addAnswerQuestionText"></p>
                        </div>
                        <div class="mb-3">
                            <label for="addAnswerText" class="form-label">Answer</label>
                            <textarea class="form-control" id="addAnswerText" rows="4" required></textarea>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            This request will be sent to admin for approval.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitAddAnswerRequest()">
                        <i class="fas fa-paper-plane me-2"></i>Submit Request
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteQuestionModal" tabindex="-1" aria-labelledby="deleteQuestionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteQuestionModalLabel">
                        <i class="fas fa-trash me-2"></i>Delete Question
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this question?</p>
                    <div class="question-preview bg-light p-3 rounded">
                        <strong id="deleteQuestionPreview"></strong>
                    </div>
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This action requires admin approval.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="submitDeleteRequest()">
                        <i class="fas fa-trash me-2"></i>Request Deletion
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../scripts/auth.js"></script>
    <script>
        let currentQuestions = [];
        let currentRequestedQuestions = [];
        let currentModificationRequests = [];
        let currentDeleteQuestionId = null;

        // Load questions when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            await loadQuestionStats();
            await loadValidQuestions();
            await loadRequestedQuestions();
            await loadModificationRequests();
            
            // Start auto-refresh
            startQuestionsRefresh();
        });

        async function loadQuestionStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/client/question-stats`, {
                    headers: authService.getAuthHeaders()
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    updateQuestionStats(stats);
                }
            } catch (error) {
                console.error('Error loading question stats:', error);
            }
        }

        function updateQuestionStats(stats) {
            document.getElementById('validQuestionsCount').textContent = stats.valid_questions_count || 0;
            document.getElementById('requestedQuestionsCount').textContent = stats.requested_questions_count || 0;
            document.getElementById('pendingRequestsCount').textContent = stats.pending_requests_count || 0;
            document.getElementById('userHitsCount').textContent = stats.user_hits_used || 0;
            
            // Update badges
            document.getElementById('validQuestionsBadge').textContent = stats.valid_questions_count || 0;
            document.getElementById('requestedQuestionsBadge').textContent = stats.requested_questions_count || 0;
            document.getElementById('modificationRequestsBadge').textContent = stats.pending_requests_count || 0;
        }

        async function loadValidQuestions() {
            try {
                const response = await fetch(`${API_BASE_URL}/client/questions`, {
                    headers: authService.getAuthHeaders()
                });
                
                if (response.ok) {
                    currentQuestions = await response.json();
                    displayValidQuestions(currentQuestions);
                }
            } catch (error) {
                console.error('Error loading valid questions:', error);
            }
        }

        function displayValidQuestions(questions) {
            const container = document.getElementById('validQuestionsList');
            
            if (questions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-question-circle"></i>
                        <h4>No Valid Questions</h4>
                        <p>Questions that have been answered will appear here.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = questions.map(question => `
                <div class="question-item">
                    <div class="question-header">
                        <div class="question-text">
                            ${escapeHtml(question.question)}
                            <span class="question-count">Triggered ${question.asked_count || 0} times</span>
                        </div>
                        <div class="question-actions">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" 
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="openModifyModal('${question._id}', 'modify')">
                                            <i class="fas fa-edit me-2"></i>Modify
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item text-danger" href="#" onclick="openDeleteModal('${question._id}', '${escapeHtml(question.question)}')">
                                            <i class="fas fa-trash me-2"></i>Delete
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="answer-text">
                        ${escapeHtml(question.answer)}
                    </div>
                </div>
            `).join('');
        }

        async function loadRequestedQuestions() {
            try {
                const response = await fetch(`${API_BASE_URL}/client/requested-questions`, {
                    headers: authService.getAuthHeaders()
                });
                
                if (response.ok) {
                    currentRequestedQuestions = await response.json();
                    displayRequestedQuestions(currentRequestedQuestions);
                }
            } catch (error) {
                console.error('Error loading requested questions:', error);
            }
        }

        function displayRequestedQuestions(questions) {
            const container = document.getElementById('requestedQuestionsList');
            
            if (questions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-question"></i>
                        <h4>No Requested Questions</h4>
                        <p>Questions asked by users that need answers will appear here.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = questions.map(question => `
                <div class="question-item requested-question">
                    <div class="question-header">
                        <div class="question-text">
                            ${escapeHtml(question.question_text)}
                            <span class="question-count">Asked ${question.count || 0} times</span>
                        </div>
                        <div class="question-actions">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" 
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="openAddAnswerModal('${question._id}', '${escapeHtml(question.question_text)}')">
                                            <i class="fas fa-plus me-2"></i>Add Answer
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="text-muted mt-2">
                        <small>Users have asked this question but no answer is available yet.</small>
                    </div>
                </div>
            `).join('');
        }

        async function loadModificationRequests() {
            try {
                const response = await fetch(`${API_BASE_URL}/question-requests`, {
                    headers: authService.getAuthHeaders()
                });
                
                if (response.ok) {
                    currentModificationRequests = await response.json();
                    displayModificationRequests(currentModificationRequests);
                }
            } catch (error) {
                console.error('Error loading modification requests:', error);
            }
        }

        function displayModificationRequests(requests) {
            const container = document.getElementById('modificationRequestsList');
            
            if (requests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-edit"></i>
                        <h4>No Modification Requests</h4>
                        <p>Your question modification requests will appear here.</p>
                    </div>
                `;
                return;
            }

            // Sort by creation date, latest first
            requests.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

            container.innerHTML = requests.map(request => `
                <div class="question-item modification-requests">
                    <div class="question-header">
                        <div class="question-text">
                            ${escapeHtml(request.question)}
                            <span class="request-status status-${request.status}">
                                ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                            </span>
                        </div>
                    </div>
                    <div class="mb-2">
                        <strong>Type:</strong> ${request.request_type.charAt(0).toUpperCase() + request.request_type.slice(1)}
                    </div>
                    ${request.answer ? `
                        <div class="answer-text">
                            ${escapeHtml(request.answer)}
                        </div>
                    ` : ''}
                    ${request.admin_notes ? `
                        <div class="mt-2">
                            <strong>Admin Notes:</strong> ${escapeHtml(request.admin_notes)}
                        </div>
                    ` : ''}
                    <div class="text-muted mt-2">
                        <small>Submitted: ${new Date(request.created_at).toLocaleString()}</small>
                        ${request.processed_at ? 
                            `<small class="ms-3">Processed: ${new Date(request.processed_at).toLocaleString()}</small>` : 
                            ''
                        }
                    </div>
                </div>
            `).join('');
        }

        // Modal functions
        function openModifyModal(questionId, type) {
            const question = currentQuestions.find(q => q._id === questionId);
            if (!question) return;

            document.getElementById('modifyQuestionId').value = questionId;
            document.getElementById('modifyQuestionType').value = type;
            document.getElementById('modifyQuestionText').value = question.question;
            document.getElementById('modifyAnswerText').value = question.answer;

            const modal = new bootstrap.Modal(document.getElementById('modifyQuestionModal'));
            modal.show();
        }

        function openAddAnswerModal(questionId, questionText) {
            document.getElementById('addAnswerQuestionId').value = questionId;
            document.getElementById('addAnswerQuestionText').textContent = questionText;
            document.getElementById('addAnswerText').value = '';

            const modal = new bootstrap.Modal(document.getElementById('addAnswerModal'));
            modal.show();
        }

        function openDeleteModal(questionId, questionText) {
            currentDeleteQuestionId = questionId;
            document.getElementById('deleteQuestionPreview').textContent = questionText;

            const modal = new bootstrap.Modal(document.getElementById('deleteQuestionModal'));
            modal.show();
        }

        // Request submission functions
        async function submitModificationRequest() {
            const questionId = document.getElementById('modifyQuestionId').value;
            const question = document.getElementById('modifyQuestionText').value.trim();
            const answer = document.getElementById('modifyAnswerText').value.trim();
            const type = document.getElementById('modifyQuestionType').value;

            if (!question || !answer) {
                showNotification('Please fill both question and answer fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/client/question-modification-request`, {
                    method: 'POST',
                    headers: authService.getAuthHeaders(),
                    body: JSON.stringify({
                        question_id: questionId,
                        question: question,
                        answer: answer,
                        request_type: type
                    })
                });

                if (response.ok) {
                    showNotification('Modification request submitted successfully!', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modifyQuestionModal'));
                    modal.hide();
                    
                    // Reload data
                    await loadModificationRequests();
                    await loadQuestionStats();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to submit request');
                }
            } catch (error) {
                console.error('Error submitting modification request:', error);
                showNotification('Error: ' + error.message, 'error');
            }
        }

        async function submitAddAnswerRequest() {
            const questionId = document.getElementById('addAnswerQuestionId').value;
            const question = document.getElementById('addAnswerQuestionText').textContent;
            const answer = document.getElementById('addAnswerText').value.trim();

            if (!answer) {
                showNotification('Please provide an answer', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/client/question-modification-request`, {
                    method: 'POST',
                    headers: authService.getAuthHeaders(),
                    body: JSON.stringify({
                        question: question,
                        answer: answer,
                        request_type: 'add'
                    })
                });

                if (response.ok) {
                    showNotification('Answer request submitted successfully!', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addAnswerModal'));
                    modal.hide();
                    
                    // Reload data
                    await loadModificationRequests();
                    await loadQuestionStats();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to submit request');
                }
            } catch (error) {
                console.error('Error submitting add answer request:', error);
                showNotification('Error: ' + error.message, 'error');
            }
        }

        async function submitDeleteRequest() {
            if (!currentDeleteQuestionId) return;

            const question = currentQuestions.find(q => q._id === currentDeleteQuestionId);
            if (!question) return;

            try {
                const response = await fetch(`${API_BASE_URL}/client/question-modification-request`, {
                    method: 'POST',
                    headers: authService.getAuthHeaders(),
                    body: JSON.stringify({
                        question_id: currentDeleteQuestionId,
                        question: question.question,
                        answer: question.answer,
                        request_type: 'delete'
                    })
                });

                if (response.ok) {
                    showNotification('Delete request submitted successfully!', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('deleteQuestionModal'));
                    modal.hide();
                    
                    // Reset state
                    currentDeleteQuestionId = null;
                    
                    // Reload data
                    await loadModificationRequests();
                    await loadQuestionStats();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to submit delete request');
                }
            } catch (error) {
                console.error('Error submitting delete request:', error);
                showNotification('Error: ' + error.message, 'error');
            }
        }

        function startQuestionsRefresh() {
            // Refresh data every 30 seconds
            setInterval(async () => {
                await loadQuestionStats();
                await loadValidQuestions();
                await loadRequestedQuestions();
                await loadModificationRequests();
            }, 30000);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show`;
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                z-index: 1000;
                min-width: 300px;
            `;
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>